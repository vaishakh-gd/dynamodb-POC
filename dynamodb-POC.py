s="Click#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=cl;AvailableInventory#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=ai;C1#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=c1;VideoThirdQuartile#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=vi_75;ImpressionDspWin#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=dsp_win;VideoStarted#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=vi_0;VideoCompleted#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=ae;C4#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=c4;ReqRes#s3://sigmoid-vdopia-etl/vdopiasample/ingest/ReqRes/b0bebcfcd12d88a04d2a535368a77ebc/2019_04_12_22_32_01/application_1537229692699_151933/runAt_2019_04_12_22_32_12;ServedInventory#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=si;C3#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=c3;VideoMidPoint#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=vi_50;C5#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=c5;Win#s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/fc70880a97567e54776f152e8cec4800/2019_04_12_22_02_04/application_1537229692699_151933/runAt_2019_04_12_22_02_08,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/e83ab20dd55ffaa282dd50eefaa47a1/2019_04_12_22_08_01/application_1537229692699_151933/runAt_2019_04_12_22_08_09,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/b4ddc820e8e6ab6b30b4a958be62e5a4/2019_04_12_22_14_04/application_1537229692699_151933/runAt_2019_04_12_22_14_08,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/deb3a5c1ef0e226cdcfbe13448353232/2019_04_12_22_20_01/application_1537229692699_151933/runAt_2019_04_12_22_20_08,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/b32bf9258bc1e86f4a17205944124e0e/2019_04_12_22_26_07/application_1537229692699_151933/runAt_2019_04_12_22_26_13,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/b0bebcfcd12d88a04d2a535368a77ebc/2019_04_12_22_32_01/application_1537229692699_151933/runAt_2019_04_12_22_32_12,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/6cb2b288eaf0b082c1e6b822b2bef995/2019_04_12_22_38_01/application_1537229692699_151933/runAt_2019_04_12_22_38_09,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/f603047afe75806e9db675bbaad577ee/2019_04_12_22_44_03/application_1537229692699_151933/runAt_2019_04_12_22_44_12,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/b7d459951e92ef50a8b995394a5cf99e/2019_04_12_22_50_01/application_1537229692699_151933/runAt_2019_04_12_22_50_07,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/b135fe186f3e86dd23c65306a25321f2/2019_04_12_22_56_04/application_1537229692699_151933/runAt_2019_04_12_22_56_11,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/d72665b9cb969022761ee3b42a4ef643/2019_04_12_23_02_01/application_1537229692699_151933/runAt_2019_04_12_23_02_11,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/ff9f4bcf92b0ec1eee98dc65c38bd672/2019_04_12_23_08_05/application_1537229692699_151933/runAt_2019_04_12_23_08_07,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/218ebee0e50c9518c808137549429a5/2019_04_12_23_14_01/application_1537229692699_151933/runAt_2019_04_12_23_14_06,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/bf45ced95e36246bc8fd9382ca32998a/2019_04_12_23_20_01/application_1537229692699_151933/runAt_2019_04_12_23_20_15,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/820a6fe8575aff2c14734bacc800c849/2019_04_12_23_26_03/application_1537229692699_151933/runAt_2019_04_12_23_26_15,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/26cc8e3de5b2019d5a682a7c9c6ccccd/2019_04_12_23_32_05/application_1537229692699_151933/runAt_2019_04_12_23_32_11,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/22540065822c01aad4863b5f49df5320/2019_04_12_23_38_01/application_1537229692699_151933/runAt_2019_04_12_23_38_05,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/59b665b710f9a643a7986b4215807bc/2019_04_12_23_44_05/application_1537229692699_151933/runAt_2019_04_12_23_44_16,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/185475d99e9c339caca71129ddb0165f/2019_04_12_23_50_03/application_1537229692699_151933/runAt_2019_04_12_23_50_07,s3://sigmoid-vdopia-etl/vdopiasample/ingest/Win/220c873cb218b872dea0e2c71907b41a/2019_04_12_23_56_04/application_1537229692699_151933/runAt_2019_04_12_23_56_15;ImpressionVideo#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=vi;VideoFirstQuartile#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=vi_25;C2#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=c2;UnfilledInventory#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=ui;Skip#s3://sigmoid-vdopia-etl/vdopiasample/ingest//Measure/2019_04_12_20_23_30/partitionCol=sk"
l=s.split(";")
d={}
import boto3

client = boto3.client('dynamodb',
                      aws_access_key_id='',
                      aws_secret_access_key='',
region_name='us-east-1'
                      )
for i in l:
    t=i.split("#")
    t1=t[1:]
    d[t[0]]=t[1]
#print(d)
import json

f = open("7.txt")
f1 = open("8.txt")
#line  must contain requestId: and LogicalTree --
a=[]

for i in f.readlines():
    if(("requestId:" in i) and ("LogicalTree" in i)):
        a1 = i.split("LogicalTree")
        a.append(a1)



#print(a)



#print("AAAAAAAAAAWWWWWWWWWWWWWW" ,a)
count=0
t=[]
dict1={}
b1=False
b2=False
for j in a:
    parsedLogicalTreeJson = json.loads(j[1])
    arr=[]
    b1=False
    b2=False
    print()
    print("--------------------------------------------------------")
    arr.append("these are filters")
    filter=[]
    for m in parsedLogicalTreeJson["nodes"]["1"]["filter"]:
        print("FILTER  ISSSSIS ",m["key"]["name"])
        b1=True
        arr.append(m["key"]["name"])
        filter.append(m["key"]["name"])
        #print("filter mehhh is ",filter)
    #print("filter blehhh is ",filter)
    arr.append("these are group by list of dimensions")
    if(len(filter)>=1):
        filter.sort()
        #print("filter keee--------------------------------------ehhh is ", filter)
    s='^'
    if(filter!=None and len(filter)!=0):
        s=s.join(filter)
    groupby=[]
    for q in parsedLogicalTreeJson["nodes"]["1"]["groupBy"]:
        print("GROUPBY  ISSSSIS ",q["name"])
        b2=True
        arr.append(q["name"])
        groupby.append(q["name"])

    x=''
    if(len(groupby)>=1):
        groupby.sort()
        p = '^'
        x=p.join(groupby)
    #print("loserrrr filter is ",filter)
        s+="|"+groupby[0]
    dict1[s]=1
    t.append(arr)
    if(b1==True and b2==True):
        count+=1
        print("COUNT IS ",count)


print("count is ",count)
print("length of dict is ",len(dict1))

dict2={}
c2=0
for i in dict1.keys():
    if("|" in i):
        dict2[i]=dict1[i]
        c2+=1

print("dict2 is ", dict2)
print("c2 is ",c2)
print("len of dict2 is ",len(dict2))
print("Total dict is is ",dict1)










    #f1.write(str(parsed2["nodes"]["1"]["filter"]))



'''
parsed2 = json.loads(a[1])
print("hi babes")
print()
print(parsed2["nodes"]["1"]["filter"])
print()
print()
'''

for i in dict2.keys():
    l = client.get_item(TableName="vaishakhsPOC",
                        Key={'projectionDimensionList': {"S": i}})
    print
    if ('Item' in l):
        print("yeepppPPPPPPPPPPPPPPPPPPPPPP")
        v = int(l['Item']['count']['N']) + 1
        v1=str(v)
        print("-------------------------------------------------------------")
        print("l is ", l)
        print("-------------------------------------------------------------")

        client.put_item(TableName="vaishakhsPOC", Item={
            'groupBy': {"S": "Key"},
            'projectionDimensionList': {"S":i},
            'count': {"N": v1},
            'alreadyProjectionPresent': {"S": "yes"
                }
            })
        print("WWWWWWWWWWWWWWWWWWWW-------------------------------------------------------------")
        print("l is ", l)
        print("WWWWWWWWWWWWWWWWWWWW-------------------------------------------------------------")
    else:
        print("noppPPPPPPPPPPPPPPPPPPPPPPP")
        client.put_item(TableName="vaishakhsPOC", Item={
            'groupBy': {"S": "Key"},
            'projectionDimensionList': {"S": i},
            'count': {"N": "1"},
            'alreadyProjectionPresent': {"S": "yes"}
        }
                        )






